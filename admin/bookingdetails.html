<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Kaki Ka Kitchen Admin</title>
    <!-- plugins:css -->
    <link rel="stylesheet" href="assets/vendors/css/vendor.bundle.base.css">
    <link rel="stylesheet" href="assets/vendors/simple-line-icons/css/simple-line-icons.css">
    <!-- endinject -->
    <!-- Plugin css for this page -->
    <!-- End plugin css for this page -->
    <!-- inject:css -->
    <!-- endinject -->
    <!-- Layout styles -->
    <link rel="stylesheet" href="assets/css/vertical-light-layout/style.css">
    <!-- End layout styles -->
    <link rel="shortcut icon" href="https://kakikakitchen.co.nz/assets/img/favicon-16x16.png" />
  </head>
  <body>
    <div class="container-scroller">
   
      <!-- partial -->
      <div class="container-fluid page-body-wrapper">
        <nav class="navbar default-layout-navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
          <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-center">
            <a class="navbar-brand brand-logo" href="delivery.html">
              <img src="assets/images/logo.svg" alt="logo" class="logo-dark"  style="height: 70px;"/>
              <img src="assets/images/logo-light.svg" alt="logo-light" class="logo-light" style="height: 70px;">
            </a>
            <a class="navbar-brand brand-logo-mini" href="delivery.html"><img src="assets/images/logo-mini.svg" alt="logo"  style="height: 70px;"/></a>
            <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize" style="    color: green;">
              <span class="icon-menu"></span>
            </button>
          </div>
          <div class="navbar-menu-wrapper d-flex align-items-center"  style="background-color: #181824;">
            <h5 class="mb-0 font-weight-medium d-none d-lg-flex" style="    color: green;">Welcome to NZ Black Cars!</h5>
            <ul class="navbar-nav navbar-nav-right">
            </ul>
            <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas" style="    color: green;">
              <span class="icon-menu"></span>
            </button>
          </div>
        </nav>
        <!-- partial:../../partials/_sidebar.html -->
        <nav class="sidebar sidebar-offcanvas" id="sidebar">
          <ul class="nav">
            <li class="nav-item navbar-brand-mini-wrapper">
              <a class="nav-link navbar-brand brand-logo-mini" href="index.html"><img src="assets/images/logo-mini.svg" alt="logo" /></a>
            </li>
            <li class="nav-item nav-profile">
              <a href="#" class="nav-link">
                <div class="profile-image">
                  <img class="img-xs rounded-circle" src="https://kakikakitchen.co.nz/assets/img/logo.png" alt="profile image">
                  <div class="dot-indicator bg-success"></div>
                </div>
                <div class="text-wrapper">
                  <p class="profile-name">NZ Black Cars</p>
                  <p class="designation">Administrator</p>
                </div>
              </a>
            </li>
           
            <li class="nav-item nav-category"><span class="nav-link">Booking Details</span></li>
            <li class="nav-item">
              <a class="nav-link" href="storeorder.html">
                <span class="menu-title" id="storeordercount">Booking Orders</span>
                <i class="icon-grid menu-icon"></i>
              </a>
            </li>
           </ul>
        </nav>
        <!-- partial -->
        <div class="main-panel">
          <div class="content-wrapper">
            <div class="page-header">
              <h3 class="page-title"> Booking Details </h3>
             </div>
            <div class="row">
              <div class="col-lg-12 grid-margin stretch-card">
                <div class="card">
                  <div class="card-body">
                    <div class="form-group" style="display: flex; align-items: center;">
                      <label for="filterDate" style="color: #38ce3c; font-weight: bold; text-transform: uppercase; margin-right: 10px;">Select Date:</label>
                      <input type="date" id="filterDate" class="form-control" style="width: 250px;" placeholder="Select Date">
                    </div>
                    
                    <div class="table-responsive">
                      <table class="table table-striped">
                        <thead>
                          <tr>
                            <th> Order Date </th>
                            <th> Order Time </th>
                            <th> Order No </th>
                            <th> Full Name </th>
                            <th> Email </th>
                            <th> Mobile </th>
                           
                            <th> Vehical Name </th>
                            <th> Seats </th>
                            <th> Fuel </th>
                            <th> Pickup Location </th>
                            <th> Pickup Date </th>
                            <th> Pickup Time </th>
                            <th> Dropoff Location </th>
                            <th> Dropoff Date </th>
                            <th> Dropoff Time </th>
                            <th> Price </th>
                          </tr>
                        </thead>
                        <tbody id="data-table-body">
                       
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- content-wrapper ends -->
          <!-- partial:../../partials/_footer.html -->
          <footer class="footer">
            <div class="d-sm-flex justify-content-center justify-content-sm-between">
              <span class="text-muted text-center text-sm-left d-block d-sm-inline-block">Â© NZ Black Cars 2024. </span>
              <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center">Design by : <a class="text-danger" href="https://revolutionhub.co.nz/"> Revolution Hub</a></span>
            </div>
          </footer>
          <!-- partial -->
        </div>
        <!-- main-panel ends -->
      </div>
      <!-- page-body-wrapper ends -->
    </div>
    <!-- container-scroller -->
    <!-- plugins:js -->
    <script src="assets/vendors/js/vendor.bundle.base.js"></script>
    <!-- endinject -->
    <!-- Plugin js for this page -->
    <!-- End plugin js for this page -->
    <!-- inject:js -->
    <script src="assets/js/off-canvas.js"></script>
    <script src="assets/js/hoverable-collapse.js"></script>
    <script src="assets/js/misc.js"></script>
    <script src="assets/js/settings.js"></script>
    <script src="assets/js/todolist.js"></script>
    <!-- endinject -->
    <!-- Custom js for this page -->
    <!-- End custom js for this page -->
    <script>
   const filterDateInput = document.getElementById("filterDate");
const tbody = document.getElementById("data-table-body");
const scriptUrl = "https://script.google.com/macros/s/AKfycbx4Kc9NvsPRfpDTehxksXgADuXttiRGaV1G0qHsUNybw625WZonNgM27P2At5nfwyk0FQ/exec"; // Replace with your Google Apps Script URL
let previousOrderCount = 0; // Track the previous order count
let isInitialLoad = true; // Flag to prevent alert on first load

   // Function to fetch data and render table rows
function fetchAndRenderData() {
  fetch(scriptUrl)
    .then(response => response.json())
    .then(data => {

     

   
    const deliveryData = data.filter(item => item.tablename === "NZ Black Cars");

      const currentOrderCount = deliveryData.length; 
     // Calculate the number of new orders
     const newOrderCount = currentOrderCount - previousOrderCount;

// Show alert if new orders are detected
if (!isInitialLoad && newOrderCount > 0) {
  const deliveryCountElement = document.getElementById("storeordercount");
  deliveryCountElement.textContent = `Store Orders (${newOrderCount})`; // Update count display
}

previousOrderCount = currentOrderCount; // Update previous order count
isInitialLoad = false; // Set initial load to false after first fetch

      // Filter data based on selected date
      const selectedDate = filterDateInput.value;
      const filteredData = selectedDate
        ? deliveryData.filter(item => {
            const itemDate = new Date(item.currentDateTime).toISOString().split("T")[0];
            return itemDate === selectedDate;
          })
        : deliveryData;

      // Render table rows
      tbody.innerHTML = ""; // Clear existing rows
      filteredData.forEach(item => {
        const row = document.createElement("tr");

        const date = new Date(item.orderdatetime);
        const formattedDate = date.toLocaleDateString('en-GB').replace(/-/g, '/');
        const formattedTime = date.toLocaleTimeString('en-US', {
          hour: 'numeric',
          minute: 'numeric',
          hour12: true
        }).toLowerCase();

        const pickupdatetime = new Date(item.pickupdatetime);
        const pickupDate = date.toLocaleDateString('en-GB').replace(/-/g, '/');
        const pickupTime = date.toLocaleTimeString('en-US', {
          hour: 'numeric',
          minute: 'numeric',
          hour12: true
        }).toLowerCase();

        const dropoffdatetime = new Date(item.dropoffdatetime);
        const dropoffDate = date.toLocaleDateString('en-GB').replace(/-/g, '/');
        const dropoffTime = date.toLocaleTimeString('en-US', {
          hour: 'numeric',
          minute: 'numeric',
          hour12: true
        }).toLowerCase();


        row.innerHTML = `
          <td class="py-1">${formattedDate}</td>
          <td>${formattedTime}</td>
          <td>${item.orderno}</td>
          <td>${item.fullname}</td>
          <td>${item.email}</td>
          <td>${item.phone}</td>
           <td>${item.vehicalname}</td>
          <td>${item.seats}</td>
          <td>${item.fuel}</td>
          <td>${item.pickupaddress}</td>
          <td>${pickupDate}</td>
          <td>${pickupTime}</td>
           <td>${item.dropoffaddress}</td>
          <td>${dropoffDate}</td>
          <td>${dropoffTime}</td>
          <td>${item.price}</td>
        `;

        tbody.appendChild(row);
      });
    })
    .catch(error => console.error('Error fetching data:', error));
}

// Initial load
document.addEventListener("DOMContentLoaded", () => {
  const savedDate = localStorage.getItem("selectedDate");
  if (savedDate) filterDateInput.value = savedDate;
  fetchAndRenderData();
});

// Refresh data every 10 minutes without reloading the page
setInterval(fetchAndRenderData, 10000);

    </script>
    
  </body>
</html>